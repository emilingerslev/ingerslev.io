{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog","author":"Kyle Mathews"}},"markdownRemark":{"id":"909c0e4a-18cf-58c4-b36d-8cf42f9d7104","excerpt":"During the last month, there’s been a lot of changes to my life. I started a new job at Lunar Way, and not least I became a dad for the 3rd time, this time to a…","html":"<p>During the last month, there’s been a lot of changes to my life. I started a new job at Lunar Way, and not least I became a dad for the 3rd time, this time to a little boy.</p>\n<p>Big things!!… this piece is however about how I’m trying to build a reliable home automation setup using kubernetes, raspberry pi’s, home assistant, node red, IHC, hue bulbs, Ring doorbell and much more.</p>\n<p>By starting at Lunar Way I became a colleague with <a href=\"undefined\">Kasper Nissen</a> which, during one of the geek chats, told me about his (and another colleague, <a href=\"undefined\">Martin Jensen</a>’s) project <a href=\"http://kubecloud.io\">kubecloud.io</a>. In the essence, they build a small cloud of Raspberry Pi’s and installed kubernetes on them. The idea resonated with me and it made me want to replicate it. Not only because I love playing with kubernetes and want my own k8s cloud at home to geek with, but rather that I’ve got a running home automation system which could use some high availability improvements.</p>\n<h2>Ground Zero</h2>\n<p>So let’s start with where I am today:</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/2000/1*SiTusNVmVPn6k6HdiUg6WA.png\"></p>\n<p>A Synology server running Synology DiskStation with Docker installed as a plugin. On top of that I run 2 docker containers:</p>\n<ul>\n<li>\n<p><a href=\"https://www.home-assistant.io/docs/installation/docker/\">home assistant</a></p>\n</li>\n<li>\n<p><a href=\"https://hub.docker.com/r/nodered/node-red-docker/\">node-red</a></p>\n</li>\n</ul>\n<p>The setup is running alright, but now and then my Synology server seems to run low on system resources. This requires either a full server reboot or rebooting docker images and waiting for them to come up again. Not only is this a manual task, but it also leaves some downtime where no buttons in my house are working.</p>\n<h2>Just getting started</h2>\n<p>A way to <em>stabilize</em> my home automation is to make it faster to recover. That means that I need a server to take over when one becomes unavailable. This is where the kubernetes cluster comes in. Even though I been using kubernetes for quite some time I first started considering a full blown cluster when I became knowledgeable about <a href=\"undefined\">Kasper</a>’s work on using Raspberry Pi’s + kubernetes. The idea of using k8s and Pi’s fits well to my project because:</p>\n<ul>\n<li>\n<p>Raspberry Pi’s are as cheap as it gets, meaning I can have more units.</p>\n</li>\n<li>\n<p>The new Model 3 B+ have both a Quad Core CPU and 1GB of RAM meaning I got processing power enough</p>\n</li>\n<li>\n<p>Kasper (and some others) have already made a good deal of work on running kubernetes on Raspberry Pi’s, meaning I can focus on making it work for home automation.</p>\n</li>\n</ul>\n<p>To get started I ordered 4 new Raspberry Pi Model 3 B+’s and 4 64GB MicroSD cards. I also went through my old equipment and found a switch, ethernet &#x26; microusb cables + some usb power supplies and a power strip.</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/8064/1*50Af0KOIvVdZlYDx2GDgAw.png\" alt=\"My h2e Raspberry Pi setup\"><em>My h2e Raspberry Pi setup</em></p>\n<p>Since I, at the moment, use a lot of “recycled” equipment my setup look a bit messy and DIY, but I guess that will evolve over time. For now it does what it needs to do.</p>\n<p>To get the Pi’s running I’ve been working on my take on a minimalistic Ansible script, but otherwise you could also get going using the great and recently updated <a href=\"https://kubecloud.io/setting-up-a-kubernetes-1-11-raspberry-pi-cluster-using-kubeadm-952bbda329c8\">blog post</a> by <a href=\"undefined\">Kasper</a>. <em>I’ll add my link on how to use a minimalistic Ansible setup later.</em></p>\n<p>So now I have the Raspberry Pi’s running. I’ve named the cluster h2e.</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/2000/1*kkNoiO8LYghRjA8OIGrMhA.png\"></p>\n<p>The idea is that the new setup should look like this:</p>\n<ul>\n<li>\n<p>The Raspberry Pi’s running Raspbian</p>\n</li>\n<li>\n<p>Docker CE on top of the nodes</p>\n</li>\n<li>\n<p>Kubeadm spawned kubernetes cluster — multi master, but with masters doing worker work</p>\n</li>\n<li>\n<p>Weave network overlay — wanted to try out Cilium, but it is <a href=\"https://github.com/cilium/cilium/issues/1104\">not ready for ARM</a></p>\n</li>\n<li>\n<p>Rook.io to supply storage — for making distributed shared volumes for home-assistant and node-red</p>\n</li>\n<li>\n<p>home-assistant &#x26; node-red containers — potentially running on any of the nodes, but only one instance at the time for now</p>\n</li>\n</ul>\n<p>With a cluster with the above mentioned specs I should be able to run my home automations pretty reliable. It would be better to run multiple instances of home-assistant &#x26; node-red, so there would be no downtime, but from what I’ve been reading until now, this isn’t possible in any near future.</p>\n<h2>Coming up</h2>\n<p>I will split this project into several blog posts on the different subjects:</p>\n<ul>\n<li>\n<p>Setting up a Raspberry Pi kubernetes cluster using a minimalistic ansible playbook — <em>planned</em></p>\n</li>\n<li>\n<p>Playing with rook.io on a Raspberry Pi kubernetes cluster — <em>planned</em></p>\n</li>\n<li>\n<p>Running home-assistant and node-red on kubernetes — <em>planned</em></p>\n</li>\n</ul>","frontmatter":{"title":"Getting started on my home k8s setup","date":"September 21, 2018"}}},"pageContext":{"slug":"/2018-09-21/","previous":{"fields":{"slug":"/hi-folks/"},"frontmatter":{"title":"New Beginnings"}},"next":{"fields":{"slug":"/2018-12-29-setup-multi-master-k8s-using-kubeadm-and-ansible/"},"frontmatter":{"title":"Setup multi master k8s using Kubeadm and Ansible"}}}}