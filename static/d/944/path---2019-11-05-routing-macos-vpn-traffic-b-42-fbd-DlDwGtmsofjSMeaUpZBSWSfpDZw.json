{"data":{"site":{"siteMetadata":{"title":"ingerslev.io","author":"Emil Ingerslev"}},"markdownRemark":{"id":"f87e644d-00bf-5b0b-91c8-63d07d402f90","excerpt":"I often use VPN to connect to either my home or workplace and I guess that’s a pretty common thing to do. When you define a VPN connection using MacOS’ network…","html":"<p>I often use VPN to connect to either my home or workplace and I guess that’s a pretty common thing to do. When you define a VPN connection using MacOS’ network settings you can tell it to either:</p>\n<ul>\n<li>just route traffic the way the VPN is configured to route or</li>\n<li>route everything through the VPN</li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4e707881939e0a478336e70eb00f8392/150d8/send-all-traffic.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 258px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 10.465116279069768%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsSAAALEgHS3X78AAAAcElEQVQI1zWMUQ6DMAxDuRbSNKRtaIGWJG0DG/c/iJcG7ePJH7bfMD1mbFKR9SKxBksW2PdEloKZEpLni1bUzwnaxHvG4rn6lqtFP94mDF2YuIBLg9oegr9Q7YhTR5rh+SZw20Eu65usJWQXzYV3/ADecEvuFgbfqQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"send-all-traffic\"\n        title=\"\"\n        src=\"/static/4e707881939e0a478336e70eb00f8392/150d8/send-all-traffic.png\"\n        srcset=\"/static/4e707881939e0a478336e70eb00f8392/ba935/send-all-traffic.png 148w,\n/static/4e707881939e0a478336e70eb00f8392/150d8/send-all-traffic.png 258w\"\n        sizes=\"(max-width: 258px) 100vw, 258px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>If you want something in between that, then the GUI wont help you. If you use PPP, which is the default, then there is a nifty hook you can use: <code class=\"language-text\">/etc/ppp/ip-up</code>.</p>\n<p>This executable file will be called with some predefined arguments every time the VPN connects and allow you to setup some routing. Fx:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n/sbin/route add 192.168.1.0/24 -interface <span class=\"token variable\">$5</span>\n/sbin/route add 0.0.0.0/0 -interface <span class=\"token variable\">$1</span></code></pre></div>\n<p>This will route all within 192.168.1.0/24 (classic local network subnet) to the local interface and rest goes over the VPN. It will be handy if you just want to be able to connect to your local area network while connecting to the office VPN.</p>\n<p>The arguments above and the rest of them is:</p>\n<table>\n<thead>\n<tr>\n<th>Argument</th>\n<th>Description</th>\n<th>Example value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>$1</td>\n<td>The VPN interface</td>\n<td>ppp0</td>\n</tr>\n<tr>\n<td>$2</td>\n<td>unknown</td>\n<td></td>\n</tr>\n<tr>\n<td>$3</td>\n<td>unknown</td>\n<td>0</td>\n</tr>\n<tr>\n<td>$4</td>\n<td>Your IP on VPN network</td>\n<td>10.0.13.37</td>\n</tr>\n<tr>\n<td>$5</td>\n<td>IP of VPN gateway</td>\n<td>10.0.13.1</td>\n</tr>\n<tr>\n<td>$6</td>\n<td>IP of your local network gateway</td>\n<td>192.168.1.1</td>\n</tr>\n</tbody>\n</table>\n<p>I’ve been trying to find some good resources for the arguments given to <code class=\"language-text\">/etc/ppp/ip-up</code>, but no luck. Found the best description here <a href=\"https://superuser.com/questions/4904/how-to-selectively-route-network-traffic-through-vpn-on-mac-os-x-leopard\">https://superuser.com/questions/4904/how-to-selectively-route-network-traffic-through-vpn-on-mac-os-x-leopard</a></p>\n<p>If you have more than one VPN connection that you use often, then the above script could come to short. To overcome this we can just switch on fx the IP of the VPN gateway like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n\n<span class=\"token keyword\">case</span> <span class=\"token variable\">$4</span> <span class=\"token keyword\">in</span>\n\t192.168.1.1<span class=\"token punctuation\">)</span> <span class=\"token comment\"># Work VPN (from home)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"<span class=\"token variable\">$6</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"192.168.1.1\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span> <span class=\"token comment\"># if at home (or home like network)</span>\n      /sbin/route add 192.168.1.0/24 -interface <span class=\"token variable\">$5</span> <span class=\"token comment\"># subnet to Home VPN, let rest go it's normal way</span>\n    <span class=\"token keyword\">fi</span>\n    /sbin/route add 0.0.0.0/0 -interface <span class=\"token variable\">$1</span>\n\t\t<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>\n\t192.168.2.1<span class=\"token punctuation\">)</span> <span class=\"token comment\"># Home VPN</span>\n\t\t/sbin/route add 192.168.1.0/24 -interface <span class=\"token variable\">$1</span> <span class=\"token comment\"># Route subnet to Home VPN, let rest go it's normal way</span>\n\t\t<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>\n\t*<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>\nesac</code></pre></div>\n<p>With this in place it give me access to home network, when on remote VPN. It also skips the “home” network part, when using the VPN on the go. Lastly it allows me to route stuff to my home network when using my Home VPN.</p>\n<p>This was a lot of messy stuff just for some simple routing, but it gets the job done. And networking is messy, just ask the president:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b0ae69927e30afc694bfe2120fbe4efd/0d58d/cables.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 70.35123966942149%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAgAD/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgED/9oADAMBAAIQAxAAAAHRE5tRlP/EABsQAAICAwEAAAAAAAAAAAAAAAIDAAERExQi/9oACAEBAAEFAuhc3BjeuAPlY5olKu//xAAVEQEBAAAAAAAAAAAAAAAAAAAAIf/aAAgBAwEBPwGq/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERIf/aAAgBAgEBPwHFQ//EAB4QAAIBAwUAAAAAAAAAAAAAAAABIREykTFBQmGB/9oACAEBAAY/ArVglLBYmU0XROzOXh//xAAbEAEAAgMBAQAAAAAAAAAAAAABABEhMXFBYf/aAAgBAQABPyES91XAYt8lZxwBGNIOPiWp6JYGjxP/2gAMAwEAAgADAAAAECcv/8QAFhEAAwAAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EEpKP//EABYRAQEBAAAAAAAAAAAAAAAAAAABIf/aAAgBAgEBPxC7Qf/EAB4QAQACAQQDAAAAAAAAAAAAAAEAESExUWGhQYGR/9oACAEBAAE/ED6eEVmzKKGt9RZVGLAdxhlAJr25lllRItjzptiaPdkQPk//2Q=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"cables\"\n        title=\"\"\n        src=\"/static/b0ae69927e30afc694bfe2120fbe4efd/f8fb9/cables.jpg\"\n        srcset=\"/static/b0ae69927e30afc694bfe2120fbe4efd/e8976/cables.jpg 148w,\n/static/b0ae69927e30afc694bfe2120fbe4efd/63df2/cables.jpg 295w,\n/static/b0ae69927e30afc694bfe2120fbe4efd/f8fb9/cables.jpg 590w,\n/static/b0ae69927e30afc694bfe2120fbe4efd/85e3d/cables.jpg 885w,\n/static/b0ae69927e30afc694bfe2120fbe4efd/0d58d/cables.jpg 968w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>","frontmatter":{"title":"How to route MacOS (Catalina) traffic as you like ","date":"November 05, 2019","cover_image":null}}},"pageContext":{"slug":"/2019-11-05-routing-macos-vpn-traffic/","previous":{"fields":{"slug":"/2018-12-29-setup-multi-master-k8s-using-kubeadm-and-ansible/"},"frontmatter":{"title":"Setup multi master k8s using Kubeadm and Ansible"}},"next":null}}