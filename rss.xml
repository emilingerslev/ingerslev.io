<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[ingerslev.io]]></title><description><![CDATA[ingerslev.io]]></description><link>https://ingerslev.io/</link><generator>RSS for Node</generator><lastBuildDate>Tue, 05 Nov 2019 19:23:40 GMT</lastBuildDate><item><title><![CDATA[How to route MacOS (Catalina) traffic as you like ]]></title><description><![CDATA[I often use VPN to connect to either my home or workplace and I guess that’s a pretty common thing to do. When you define a VPN connection…]]></description><link>https://ingerslev.io//2019-11-05-routing-macos-vpn-traffic/</link><guid isPermaLink="false">https://ingerslev.io//2019-11-05-routing-macos-vpn-traffic/</guid><pubDate>Tue, 05 Nov 2019 18:00:35 GMT</pubDate><content:encoded>&lt;p&gt;I often use VPN to connect to either my home or workplace and I guess that’s a pretty common thing to do. When you define a VPN connection using MacOS’ network settings you can tell it to either:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;just route traffic the way the VPN is configured to route&lt;/li&gt;
&lt;li&gt;route everything through the VPN&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4e707881939e0a478336e70eb00f8392/150d8/send-all-traffic.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 258px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 10.465116279069768%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsSAAALEgHS3X78AAAAcElEQVQI1zWMUQ6DMAxDuRbSNKRtaIGWJG0DG/c/iJcG7ePJH7bfMD1mbFKR9SKxBksW2PdEloKZEpLni1bUzwnaxHvG4rn6lqtFP94mDF2YuIBLg9oegr9Q7YhTR5rh+SZw20Eu65usJWQXzYV3/ADecEvuFgbfqQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;send-all-traffic&quot;
        title=&quot;&quot;
        src=&quot;/static/4e707881939e0a478336e70eb00f8392/150d8/send-all-traffic.png&quot;
        srcset=&quot;/static/4e707881939e0a478336e70eb00f8392/ba935/send-all-traffic.png 148w,
/static/4e707881939e0a478336e70eb00f8392/150d8/send-all-traffic.png 258w&quot;
        sizes=&quot;(max-width: 258px) 100vw, 258px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;If you want something in between that, then the GUI wont help you. However, if you use PPP (which is the default) then there is a nifty hook you can use: &lt;code class=&quot;language-text&quot;&gt;/etc/ppp/ip-up&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This executable file will be called with some predefined arguments every time the VPN connects and allow you to setup some routing. Fx:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/sh&lt;/span&gt;
/sbin/route add 192.168.1.0/24 -interface &lt;span class=&quot;token variable&quot;&gt;$5&lt;/span&gt;
/sbin/route add 0.0.0.0/0 -interface &lt;span class=&quot;token variable&quot;&gt;$1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The file can be created if not already there, just remember to make it executable with &lt;code class=&quot;language-text&quot;&gt;sudo chmod +x /etc/ppp/ip-up&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The above script will route all within 192.168.1.0/24 (classic local network subnet) to the local interface and rest goes over the VPN. It will be handy if you just want to be able to connect to your local area network while connecting to the office VPN.&lt;/p&gt;
&lt;p&gt;The arguments above and the rest of them is:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Argument&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;th&gt;Example value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;$1&lt;/td&gt;
&lt;td&gt;The VPN interface&lt;/td&gt;
&lt;td&gt;ppp0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;$2&lt;/td&gt;
&lt;td&gt;unknown&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;$3&lt;/td&gt;
&lt;td&gt;unknown&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;$4&lt;/td&gt;
&lt;td&gt;Your IP on VPN network&lt;/td&gt;
&lt;td&gt;10.0.13.37&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;$5&lt;/td&gt;
&lt;td&gt;IP of VPN gateway&lt;/td&gt;
&lt;td&gt;10.0.13.1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;$6&lt;/td&gt;
&lt;td&gt;IP of your local network gateway&lt;/td&gt;
&lt;td&gt;192.168.1.1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;I’ve been trying to find some good resources for the arguments given to &lt;code class=&quot;language-text&quot;&gt;/etc/ppp/ip-up&lt;/code&gt;, but no luck. Found the best description here &lt;a href=&quot;https://superuser.com/questions/4904/how-to-selectively-route-network-traffic-through-vpn-on-mac-os-x-leopard&quot;&gt;https://superuser.com/questions/4904/how-to-selectively-route-network-traffic-through-vpn-on-mac-os-x-leopard&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;If you have more than one VPN connection that you use often, then the above script could come to short. To overcome this we can just switch on fx the IP of the VPN gateway like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/sh&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$4&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
	192.168.1.1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# Work VPN (from home)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$6&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;192.168.1.1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# if at home (or home like network)&lt;/span&gt;
      /sbin/route add 192.168.1.0/24 -interface &lt;span class=&quot;token variable&quot;&gt;$5&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# subnet to Home VPN, let rest go it&apos;s normal way&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;
    /sbin/route add 0.0.0.0/0 -interface &lt;span class=&quot;token variable&quot;&gt;$1&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	192.168.2.1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# Home VPN&lt;/span&gt;
		/sbin/route add 192.168.1.0/24 -interface &lt;span class=&quot;token variable&quot;&gt;$1&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# Route subnet to Home VPN, let rest go it&apos;s normal way&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	*&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
esac&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With this in place it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;give me access to home network, when on remote VPN.&lt;/li&gt;
&lt;li&gt;it also skips the “home” network part, when using the VPN on the go.&lt;/li&gt;
&lt;li&gt;lastly it allows me to route stuff to my home network when using my Home VPN.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This was a lot of messy stuff just for some simple routing, but it gets the job done. And networking is messy, just ask the president:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b0ae69927e30afc694bfe2120fbe4efd/0d58d/cables.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 70.35123966942149%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAgAD/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgED/9oADAMBAAIQAxAAAAHRE5tRlP/EABsQAAICAwEAAAAAAAAAAAAAAAIDAAERExQi/9oACAEBAAEFAuhc3BjeuAPlY5olKu//xAAVEQEBAAAAAAAAAAAAAAAAAAAAIf/aAAgBAwEBPwGq/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERIf/aAAgBAgEBPwHFQ//EAB4QAAIBAwUAAAAAAAAAAAAAAAABIREykTFBQmGB/9oACAEBAAY/ArVglLBYmU0XROzOXh//xAAbEAEAAgMBAQAAAAAAAAAAAAABABEhMXFBYf/aAAgBAQABPyES91XAYt8lZxwBGNIOPiWp6JYGjxP/2gAMAwEAAgADAAAAECcv/8QAFhEAAwAAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EEpKP//EABYRAQEBAAAAAAAAAAAAAAAAAAABIf/aAAgBAgEBPxC7Qf/EAB4QAQACAQQDAAAAAAAAAAAAAAEAESExUWGhQYGR/9oACAEBAAE/ED6eEVmzKKGt9RZVGLAdxhlAJr25lllRItjzptiaPdkQPk//2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;cables&quot;
        title=&quot;&quot;
        src=&quot;/static/b0ae69927e30afc694bfe2120fbe4efd/f8fb9/cables.jpg&quot;
        srcset=&quot;/static/b0ae69927e30afc694bfe2120fbe4efd/e8976/cables.jpg 148w,
/static/b0ae69927e30afc694bfe2120fbe4efd/63df2/cables.jpg 295w,
/static/b0ae69927e30afc694bfe2120fbe4efd/f8fb9/cables.jpg 590w,
/static/b0ae69927e30afc694bfe2120fbe4efd/85e3d/cables.jpg 885w,
/static/b0ae69927e30afc694bfe2120fbe4efd/0d58d/cables.jpg 968w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;</content:encoded></item><item><title><![CDATA[Setup multi master k8s using Kubeadm and Ansible]]></title><link>https://ingerslev.io//2018-12-29-setup-multi-master-k8s-using-kubeadm-and-ansible/</link><guid isPermaLink="false">https://ingerslev.io//2018-12-29-setup-multi-master-k8s-using-kubeadm-and-ansible/</guid><pubDate>Sat, 29 Dec 2018 09:00:35 GMT</pubDate><content:encoded></content:encoded></item><item><title><![CDATA[Getting started on my home k8s setup]]></title><description><![CDATA[During the last month, there’s been a lot of changes to my life. I started a new job at Lunar Way, and not least I became a dad for the 3rd…]]></description><link>https://ingerslev.io//2018-09-21-getting-started-on-my-home-k8s-setup/</link><guid isPermaLink="false">https://ingerslev.io//2018-09-21-getting-started-on-my-home-k8s-setup/</guid><pubDate>Fri, 21 Sep 2018 19:56:35 GMT</pubDate><content:encoded>&lt;p&gt;During the last month, there’s been a lot of changes to my life. I started a new job at Lunar Way, and not least I became a dad for the 3rd time, this time to a little boy.&lt;/p&gt;
&lt;p&gt;Big things!!… this piece is however about how I’m trying to build a reliable home automation setup using kubernetes, raspberry pi’s, home assistant, node red, IHC, hue bulbs, Ring doorbell and much more.&lt;/p&gt;
&lt;p&gt;By starting at Lunar Way I became a colleague with &lt;a href=&quot;undefined&quot;&gt;Kasper Nissen&lt;/a&gt; which, during one of the geek chats, told me about his (and another colleague, &lt;a href=&quot;undefined&quot;&gt;Martin Jensen&lt;/a&gt;’s) project &lt;a href=&quot;http://kubecloud.io&quot;&gt;kubecloud.io&lt;/a&gt;. In the essence, they build a small cloud of Raspberry Pi’s and installed kubernetes on them. The idea resonated with me and it made me want to replicate it. Not only because I love playing with kubernetes and want my own k8s cloud at home to geek with, but rather that I’ve got a running home automation system which could use some high availability improvements.&lt;/p&gt;
&lt;h2&gt;Ground Zero&lt;/h2&gt;
&lt;p&gt;So let’s start with where I am today:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/564f76507df4853125a6314ca5275ebf/70a50/stack.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 318px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 119.81132075471699%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsSAAALEgHS3X78AAAEPUlEQVQ4y5WV208cVRzH592XvvVfMNEHo0aTWl940QdMNDHFFtHSpDU1YFuW4EhXTXyQGmxLSUhxkaayCCJsYCu3rAQL7G3uszuXndkbuzQQU33SZNdlZs7P3xnA+AKBh0/O7Ln8buf7O8sIgvCnLEkgZ7OEj8XIdFsbmW5tJYlIhCia5tqWBaIoznEcN2jbNsiS6HBKltzhnpDb/A6JiHmiySIRRLQhy7tMJpOBdDIJKh7cGB6G0KlTMHr6NCz39oKcyxFT1+nGBDqOGKYJssCRVSUHQ1YNFrd34YG6A7osAsfzQG0xkiT9LQrCrmoYDS4abYTPvt6YbGpqxMPjDVnXa8aewUc8zw8ZhgmqJNYSGbPRLz1t3BKfNsJytWGocgMjbKiq2mASiUQ7l04HE8kUK6oqq6kyixGzWlZkTQRTDaZSqfZ0On0e+TyVTrM8srjBsTNrPLuR4lg8z+LaZ7ivi8lms38ZOeufgpWra5lMfV1Q6pqm18NziXo0lqLftVwu55im6SE1pE6xcmbdRnK5vd/71Bhal62yDRuiAJfmeHimYwAuf3sfBqd1uDUugW2ZQC/Dwhrn83n/e4/8PvZ/0HVGkhVy+6cM+eh7m7z9Q5W83PsLafrqN9I3XSW6liH5vE0wwmPDpFNJrzNU8jqnwPtirOJ131vzuh+B1/2g4Kky79n5gocbjw1TLNgwsxiHudTvMCM50DFeg+tjf0B0RYTtJxUob27C5jGpVCrAaJqmalnVXn0ct2ZjvDX0c9paXlmzCpZh6YZpGYZxEkwGr/oDRc30YAd08cm1gJ1NBsrFfIDjxQB2SAA16IPCPoouOqJWP2EwbyiVSlCtVqHis4VCVvZ+Ywp0rVgswtbWlj93GHTdT1lRFC8ej7soTHcDR0EU3bsDA25fX5/b39/vjo6OuujdRVm46NxF+RwJFTbRaHspCkFhAtYB0AHMzs5CKBSC+fl5P0qqMZrNIZCDkUkmk+7IyIgTi8XcqakpZ2xszIlEIs7CwoITjUad5eVlZ2JiwllaWnLQqEO75hBoBo5fQ0yXPlGAfQt4SaAosj/S14POr6+vg45Z7OzswPb29pEweDNXUDpf4uGbhUIxSMHDQZwL4uvhj+g0iOtB3BvEevrQ7/9xc3+uh17KYyy4hIeE1dVfkRVBliUB6ylgPQWssQ8aFtDRUYgIx1CFiyIP4fAoDNz9Gobv34GR0CA8fPgdykfy0ziQxXGgEbpdNzq8lnPveG3vt3gXPzzvsZ9e8651XvaWlha8UqlMn63j9zIahJ6eLrhw4Ry0vPcuvPjSC3DpYivcuH4V5bMOWFNfGvT5Og6+Dtvb2+C1s6+S5uY34MyZVwCjhHsD34Bu6P6mExmkYp74cZx8fPUKvNX8Jjz/3LPAsgGUSdZ/QE9i7CDCXVr0crlM8A8LJicnIJlI+N1BnZ00wn8BQugV1PPxfxoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;stack&quot;
        title=&quot;&quot;
        src=&quot;/static/564f76507df4853125a6314ca5275ebf/70a50/stack.png&quot;
        srcset=&quot;/static/564f76507df4853125a6314ca5275ebf/0886e/stack.png 148w,
/static/564f76507df4853125a6314ca5275ebf/36ddf/stack.png 295w,
/static/564f76507df4853125a6314ca5275ebf/70a50/stack.png 318w&quot;
        sizes=&quot;(max-width: 318px) 100vw, 318px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;A Synology server running Synology DiskStation with Docker installed as a plugin. On top of that I run 2 docker containers:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://www.home-assistant.io/docs/installation/docker/&quot;&gt;home assistant&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://hub.docker.com/r/nodered/node-red-docker/&quot;&gt;node-red&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The setup is running alright, but now and then my Synology server seems to run low on system resources. This requires either a full server reboot or rebooting docker images and waiting for them to come up again. Not only is this a manual task, but it also leaves some downtime where no buttons in my house are working.&lt;/p&gt;
&lt;h2&gt;Just getting started&lt;/h2&gt;
&lt;p&gt;A way to &lt;em&gt;stabilize&lt;/em&gt; my home automation is to make it faster to recover. That means that I need a server to take over when one becomes unavailable. This is where the kubernetes cluster comes in. Even though I been using kubernetes for quite some time I first started considering a full blown cluster when I became knowledgeable about &lt;a href=&quot;undefined&quot;&gt;Kasper&lt;/a&gt;’s work on using Raspberry Pi’s + kubernetes. The idea of using k8s and Pi’s fits well to my project because:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Raspberry Pi’s are as cheap as it gets, meaning I can have more units.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The new Model 3 B+ have both a Quad Core CPU and 1GB of RAM meaning I got processing power enough&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kasper (and some others) have already made a good deal of work on running kubernetes on Raspberry Pi’s, meaning I can focus on making it work for home automation.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To get started I ordered 4 new Raspberry Pi Model 3 B+’s and 4 64GB MicroSD cards. I also went through my old equipment and found a switch, ethernet &amp;#x26; microusb cables + some usb power supplies and a power strip.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/641206fcc761021ef18b2152523463f5/815cb/my-pi-setup.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsSAAALEgHS3X78AAADnklEQVQozwGTA2z8ANnEsdnGt9zNwdzNwdvOwtzLvtvGs9fAqtfBrNnEsd7KuMq5qX53caickM+6qs+6qtXCt9PAtsy5rdnHuwDhzLvhzL7h0MTbybzTwrTUwrPRv67HtaTItabJuKnLuad+dWsfISEtLi6VioDLuKnKuKvWw7rTw7zYycAA3Max3cm60sCxuqWTtqGOuKSRtqOTtqOTvq6fuKufr6CTgHNoMzEtMDQ3fnlyx7Wlybeo0b+y1MO41cO3ANvJu9jGub2nk6iRea+bhquZg6aTe5SEcGpgVZWFc6COdp6Lcl9ZUC43P1hZWI+FepmOgcWzn9PBtNLAtQDSx7/Lv7W4qJfZ1svd4NjMzsa8vri1t7BGTE83PD+DiYd6fnsxNTcjLDkeMUwkN1QsP1iyo5XVwbTUwLQA1MrC0MS8rZqKw7Wjw8G4gIOCj5GMq6mhXl5cFhodUVdcVlxdUVRTREpSOktfPU5oOEljqJuQ28vCxbiyANTAr8q1o62Vf5J6YkA7NBUZGSMhHVZIOjMvKgwQEwwQEm10d7a8uquxsKuytzM/VDRCXKKXjtTFu6uinQDbybrSv7KtmIRCPTYXGRoxLyweIiMnKCceISEaICVITk+Qm6LMxceIiox1foVzf4xGU2Womo3Mv7a6sq4A4tHF2ce8tZyIamFWICUnKjA1KS0wLi4uTUxJd3h3Y2RkYGJmnp+mqbG1f358lpOMd3JqqZiDsqmi0MnGAOTSxeDPxMSuma+ZgW9mW3Z2dHRrYHtqWpKGe4V6bWRVRnRtZ2tpZmpjW351a3JtaZGGd6GSgcrAt+3f1QDp2c/h0snDrpq5oIWNkICHk4eBdmJwbmBgb2aAdGJpYE5BUUp8dmh5aFZdb2WMl46jk4O1oo3dyrzgzL8A4tPG2sm+wKqVuZ2DVGpbS3ZphHZlR1JEMVxQenFgXldHLllNbHFkfWlVOFlMVm5imYVzpZWE1MK218S4ANXIvtLDusOvnrqfhH6Hd2eFeXBsXGJjVVhxZmloWWVcTU5mW15oXGpfUVpoXGN1Zn51aLyrmtbFuNfGuwDg0cbYy8PRwrTJs521pI2snIWynoesmoKik3yok3yrlHuYhnCZiHOmk3+pl4Ovn4zCsaDZx7fXxrvYxrkA5dbM3c/F18e90L+zybaowKqbuKOVt6OWt6GVsZ2SqZaNp5OKpJGHqJSIsZyQuKWZw7Ckz7yx28i94My9zy/7R2YaVLMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;My h2e Raspberry Pi setup&quot;
        title=&quot;&quot;
        src=&quot;/static/641206fcc761021ef18b2152523463f5/fb8a0/my-pi-setup.png&quot;
        srcset=&quot;/static/641206fcc761021ef18b2152523463f5/1a291/my-pi-setup.png 148w,
/static/641206fcc761021ef18b2152523463f5/2bc4a/my-pi-setup.png 295w,
/static/641206fcc761021ef18b2152523463f5/fb8a0/my-pi-setup.png 590w,
/static/641206fcc761021ef18b2152523463f5/526de/my-pi-setup.png 885w,
/static/641206fcc761021ef18b2152523463f5/fa2eb/my-pi-setup.png 1180w,
/static/641206fcc761021ef18b2152523463f5/08f6a/my-pi-setup.png 1770w,
/static/641206fcc761021ef18b2152523463f5/815cb/my-pi-setup.png 4000w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;em&gt;My h2e Raspberry Pi setup&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Since I, at the moment, use a lot of “recycled” equipment my setup look a bit messy and DIY, but I guess that will evolve over time. For now it does what it needs to do.&lt;/p&gt;
&lt;p&gt;To get the Pi’s running I’ve been working on my take on a minimalistic Ansible script, but otherwise you could also get going using the great and recently updated &lt;a href=&quot;https://kubecloud.io/setting-up-a-kubernetes-1-11-raspberry-pi-cluster-using-kubeadm-952bbda329c8&quot;&gt;blog post&lt;/a&gt; by &lt;a href=&quot;undefined&quot;&gt;Kasper&lt;/a&gt;. &lt;em&gt;I’ll add my link on how to use a minimalistic Ansible setup later.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;So now I have the Raspberry Pi’s running. I’ve named the cluster h2e.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9235be2d65ec6bffcbe63414459ff215/c0c25/new-stack.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 45.54216867469879%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAACfElEQVQoz02LzU/TYBzH+w/oyQRF/gE1WaJRiSDgmLzEgwfAxL2ybiRw8OCFqEEZwhwKJibbIomJHIzOdQiYTUX2wgyBbYXR9mnXtV3fhk6YSsLNk0l9iiIePvk++fw+D7KA0zvzeeEngWfcH70+QzYWPbMEeMNsXmwgKeJEyh9oWJ2bNaRI9mw4Jxg2BGEgGQz++hR6JeDVndMRXGjYYOiT6amp+nQodA4hQWGeYtgozbAzNF0Iw8X2YQrFMAVoTBRlTJIVjIJ36GYACaIAMG/pQnG/1X0knydeIhJP80qJkeQSI0OU/5EERlGlogJIXKGJHHyze04WC7DXOegUkS0XCwSLBDFuIRAREgFMiMPVWfxL3I/x8advxEXvcyLhmQZJ/e0/6PbbeADj4ZYSwTAdQ+rsX9dqrFW81lbFj8I9Zquu1dq212us27k6exU/3LOVuTq6+63Ht/v9UPdWRnf/Ovuf7rh9Gz9i/pE91SeSiHtCjqMT5aR5TEq4JtSUfVx9b/OpMfekuqS73odqsv/JZvqGf3MZfaQmzV4pCTcF/YLlgRrtmywvWbxiwjFeTg485haREkeuAhasvV6hcjxHUQJHRiSefMGwAECX4TiKForENMcSGMcBKrRCZQssRcB/MZEnn/HcXpdlimCdZdbTyCWPSzTeMsvdlkaxZcjxpXUYTUP3wXjbUumyNgnGO5aK0eN6Zxp2LbcM2T/rHbxtQocbh9E56CpdtuaScfCa3Hm/X0BMY26tfdCqOeubtMujLs3kQSvGEZTvvNurOS40aR33nFrrCFqEfqttBNWc5y9qHXccuts1eZxk26hbczQ2a+03r2tXfAPab+5/2pv/F5/lAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;new stack&quot;
        title=&quot;&quot;
        src=&quot;/static/9235be2d65ec6bffcbe63414459ff215/fb8a0/new-stack.png&quot;
        srcset=&quot;/static/9235be2d65ec6bffcbe63414459ff215/1a291/new-stack.png 148w,
/static/9235be2d65ec6bffcbe63414459ff215/2bc4a/new-stack.png 295w,
/static/9235be2d65ec6bffcbe63414459ff215/fb8a0/new-stack.png 590w,
/static/9235be2d65ec6bffcbe63414459ff215/c0c25/new-stack.png 830w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;The idea is that the new setup should look like this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The Raspberry Pi’s running Raspbian&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Docker CE on top of the nodes&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kubeadm spawned kubernetes cluster — multi master, but with masters doing worker work&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Weave network overlay — wanted to try out Cilium, but it is &lt;a href=&quot;https://github.com/cilium/cilium/issues/1104&quot;&gt;not ready for ARM&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Rook.io to supply storage — for making distributed shared volumes for home-assistant and node-red&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;home-assistant &amp;#x26; node-red containers — potentially running on any of the nodes, but only one instance at the time for now&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With a cluster with the above mentioned specs I should be able to run my home automations pretty reliable. It would be better to run multiple instances of home-assistant &amp;#x26; node-red, so there would be no downtime, but from what I’ve been reading until now, this isn’t possible in any near future.&lt;/p&gt;
&lt;h2&gt;Coming up&lt;/h2&gt;
&lt;p&gt;I will split this project into several blog posts on the different subjects:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Setting up a Raspberry Pi kubernetes cluster using a minimalistic ansible playbook — &lt;em&gt;planned&lt;/em&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Playing with rook.io on a Raspberry Pi kubernetes cluster — &lt;em&gt;planned&lt;/em&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Running home-assistant and node-red on kubernetes — &lt;em&gt;planned&lt;/em&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item></channel></rss>